{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/abhi/Documents/kmc/SIH/civic-cops-frontend/src/app/add_location/ui/MapPicker.tsx"],"sourcesContent":["\"use client\"\n\nimport React, { useEffect, useMemo, useState } from \"react\"\nimport { MapContainer, TileLayer, Marker, useMapEvents, useMap, Circle } from \"react-leaflet\"\nimport L from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\n\n// Fix default icon paths for Leaflet when bundling\n// Safely remove internal icon function if present (types may not expose it)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ndelete (L.Icon.Default.prototype as any)._getIconUrl\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png\",\n  iconUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png\",\n  shadowUrl: \"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png\",\n})\n\ntype LatLng = { lat: number; lng: number }\ntype MapPickerProps = {\n  onPick: (lat: number, lng: number) => void\n  center?: LatLng | null\n  initialCenter?: LatLng\n}\n\nfunction ClickHandler({ onPick }: { onPick: (lat: number, lng: number) => void }) {\n  useMapEvents({\n    click(e) {\n      onPick(e.latlng.lat, e.latlng.lng)\n    },\n  })\n  return null\n}\n\nfunction CenterUpdater({ center, zoom }: { center: LatLng; zoom: number }) {\n  const map = useMap()\n  useEffect(() => {\n    map.setView(center, zoom)\n  }, [center, zoom, map])\n  return null\n}\n\nexport default function MapPicker({ onPick, center, initialCenter }: MapPickerProps) {\n  const [position, setPosition] = useState<LatLng | null>(center || initialCenter || null)\n  const [zoom, setZoom] = useState<number>(13)\n  const [accuracyMeters, setAccuracyMeters] = useState<number | null>(null)\n  const [geoError, setGeoError] = useState<string>(\"\")\n\n  useEffect(() => {\n    if (center) setPosition(center)\n    else if (initialCenter) setPosition(initialCenter)\n  }, [center, initialCenter])\n\n  // Try geolocation once for a better initial center\n  useEffect(() => {\n    if (position) return\n    if (typeof window !== \"undefined\" && navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (res) => {\n          const lat = res.coords.latitude\n          const lng = res.coords.longitude\n          setPosition({ lat, lng })\n          onPick(lat, lng)\n        },\n        () => {\n          // ignore errors; default center will be used\n        },\n        { enableHighAccuracy: true, timeout: 5000 }\n      )\n    }\n  }, [position, onPick])\n\n  const effectiveCenter = useMemo(() => position || { lat: 28.6139, lng: 77.2090 }, [position])\n  const handleGeolocate = () => {\n    setGeoError(\"\")\n    if (typeof window === \"undefined\") return\n    const isSecure = window.location.protocol === \"https:\" || window.location.hostname === \"localhost\"\n    if (!isSecure) {\n      setGeoError(\"Geolocation requires HTTPS (or localhost). Please use a secure origin.\")\n      return\n    }\n    if (!(\"geolocation\" in navigator)) {\n      setGeoError(\"Geolocation not supported on this device/browser.\")\n      return\n    }\n    navigator.geolocation.getCurrentPosition(\n      (res) => {\n        const lat = res.coords.latitude\n        const lng = res.coords.longitude\n        setPosition({ lat, lng })\n        setAccuracyMeters(Number.isFinite(res.coords.accuracy) ? res.coords.accuracy : null)\n        setZoom(17)\n        onPick(lat, lng)\n      },\n      (err) => {\n        if (err.code === 1) setGeoError(\"Permission denied. Enable location access and try again.\")\n        else if (err.code === 2) setGeoError(\"Position unavailable. Try again in an open area.\")\n        else if (err.code === 3) setGeoError(\"Geolocation timed out. Please try again.\")\n        else setGeoError(\"Failed to get current location.\")\n      },\n      { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }\n    )\n  }\n\n  return (\n    <div style={{ height: \"100%\", width: \"100%\", position: \"relative\" }}>\n      <MapContainer center={effectiveCenter} zoom={zoom} style={{ height: \"100%\", width: \"100%\" }} scrollWheelZoom>\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <ClickHandler onPick={(lat, lng) => { setPosition({ lat, lng }); onPick(lat, lng) }} />\n        {position && <Marker position={position} draggable eventHandlers={{ dragend: (e: any) => {\n          const m = e.target\n          const ll = m.getLatLng()\n          setPosition({ lat: ll.lat, lng: ll.lng })\n          onPick(ll.lat, ll.lng)\n        } }} />}\n        {position && accuracyMeters && (\n          <Circle center={position} radius={accuracyMeters} pathOptions={{ color: \"#2563eb\", fillColor: \"#60a5fa\", fillOpacity: 0.2 }} />\n        )}\n        {position && <CenterUpdater center={position} zoom={zoom} />}\n      </MapContainer>\n      <button\n        type=\"button\"\n        onClick={handleGeolocate}\n        style={{ position: \"absolute\", right: 12, bottom: 12, zIndex: 1000 }}\n        className=\"h-10 px-3 rounded-md bg-white/90 border shadow text-sm font-medium\"\n        aria-label=\"Use my current location\"\n      >\n        Use my location\n      </button>\n      {geoError && (\n        <div\n          style={{ position: \"absolute\", left: 12, bottom: 12, zIndex: 1000 }}\n          className=\"px-3 py-2 rounded-md bg-white/90 border text-sm text-red-600\"\n        >\n          {geoError}\n        </div>\n      )}\n    </div>\n  )\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}}]
}